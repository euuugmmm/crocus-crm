[debug] [2025-07-29T20:43:30.895Z] ----------------------------------------------------------------------
[debug] [2025-07-29T20:43:30.897Z] Command:       /Users/evgeniy/.nvm/versions/node/v22.15.0/bin/node /Users/evgeniy/.nvm/versions/node/v22.15.0/bin/firebase functions:shell
[debug] [2025-07-29T20:43:30.898Z] CLI Version:   14.3.1
[debug] [2025-07-29T20:43:30.898Z] Platform:      darwin
[debug] [2025-07-29T20:43:30.898Z] Node Version:  v22.15.0
[debug] [2025-07-29T20:43:30.898Z] Time:          Tue Jul 29 2025 23:43:30 GMT+0300 (Eastern European Summer Time)
[debug] [2025-07-29T20:43:30.898Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-29T20:43:31.033Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-07-29T20:43:31.033Z] > authorizing via signed-in user (office@crocustours.ro)
[debug] [2025-07-29T20:43:31.034Z] [iam] checking project crocuscrm for permissions ["firebase.projects.get"]
[debug] [2025-07-29T20:43:31.034Z] Checked if tokens are valid: true, expires at: 1753823795412
[debug] [2025-07-29T20:43:31.034Z] Checked if tokens are valid: true, expires at: 1753823795412
[debug] [2025-07-29T20:43:31.035Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/crocuscrm:testIamPermissions [none]
[debug] [2025-07-29T20:43:31.035Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/crocuscrm:testIamPermissions x-goog-quota-user=projects/crocuscrm
[debug] [2025-07-29T20:43:31.035Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/crocuscrm:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-07-29T20:43:32.031Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/crocuscrm:testIamPermissions 200
[debug] [2025-07-29T20:43:32.032Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/crocuscrm:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-07-29T20:43:32.107Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-07-29T20:43:32.112Z] defaultcredentials: writing to file /Users/evgeniy/.config/firebase/office_crocustours_ro_application_default_credentials.json
[debug] [2025-07-29T20:43:32.114Z] DEBUG: Setting GAC to /Users/evgeniy/.config/firebase/office_crocustours_ro_application_default_credentials.json
[debug] [2025-07-29T20:43:32.114Z] Checked if tokens are valid: true, expires at: 1753823795412
[debug] [2025-07-29T20:43:32.114Z] Checked if tokens are valid: true, expires at: 1753823795412
[debug] [2025-07-29T20:43:32.114Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/crocuscrm/adminSdkConfig [none]
[debug] [2025-07-29T20:43:32.638Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/crocuscrm/adminSdkConfig 200
[debug] [2025-07-29T20:43:32.639Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/crocuscrm/adminSdkConfig {"projectId":"crocuscrm","storageBucket":"crocuscrm.firebasestorage.app"}
[debug] [2025-07-29T20:43:32.656Z] [functions] Watching "/Users/evgeniy/Documents/crocus-crm/functions" for Cloud Functions...
[debug] [2025-07-29T20:43:32.662Z] Validating nodejs source
[debug] [2025-07-29T20:43:33.393Z] > [functions] package.json contents: {
  "name": "functions",
  "engines": {
    "node": "18"
  },
  "scripts": {
    "build": "tsc",
    "deploy": "npm run build && firebase deploy --only functions",
    "serve": "npm run build && firebase emulators:start --only functions",
    "lint": "eslint --ext .ts src"
  },
  "main": "lib/index.js",
  "dependencies": {
    "date-fns": "^2.30.0",
    "firebase-admin": "^12.0.0",
    "firebase-functions": "^6.4.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^8.38.0",
    "@typescript-eslint/parser": "^8.38.0",
    "eslint": "^8.0.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.25.2",
    "typescript": "^4.9.5"
  }
}
[debug] [2025-07-29T20:43:33.393Z] Building nodejs source
[debug] [2025-07-29T20:43:33.393Z] Failed to find version of module node: reached end of search path /Users/evgeniy/Documents/crocus-crm/functions/node_modules
[warn] ⚠  functions: Your requested "node" version "18" doesn't match your global version "22". Using node@22 from host. 
[debug] [2025-07-29T20:43:33.395Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-07-29T20:43:33.401Z] Found firebase-functions binary at '/Users/evgeniy/Documents/crocus-crm/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8313

[debug] [2025-07-29T20:43:33.785Z] Got response from /__/functions.yaml {"endpoints":{"nightlyFinishBookings":{"availableMemoryMb":256,"timeoutSeconds":120,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["europe-west1"],"labels":{},"scheduleTrigger":{"schedule":"every day 03:05","retryConfig":{},"timeZone":"Europe/Bucharest"},"entryPoint":"nightlyFinishBookings"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{}}
[debug] [2025-07-29T20:43:37.816Z] [functions] Loaded functions definitions from source: nightlyFinishBookings.
[debug] [2025-07-29T20:43:37.818Z] [functions[europe-west1-nightlyFinishBookings]] function ignored because the pubsub emulator does not exist or is not running.
[info] i  functions: Loaded functions: nightlyFinishBookings 
[warn] ⚠  functions: The following emulators are not running, calls to these services will affect production: firestore, database, pubsub, storage, eventarc, tasks 
[debug] [2025-07-29T20:43:46.083Z] shell:nightlyFinishBookings: trigger={"entryPoint":"nightlyFinishBookings","platform":"gcfv2","region":"europe-west1","name":"nightlyFinishBookings","id":"europe-west1-nightlyFinishBookings","codebase":"default","availableMemoryMb":256,"labels":{"EVENTARC_CLOUD_EVENT_SOURCE":"run-emulated.googleapis.com/projects/crocuscrm/locations/europe-west1/services/nightlyFinishBookings"},"timeoutSeconds":120,"secretEnvironmentVariables":[],"eventTrigger":{"eventType":"pubsub","resource":""},"schedule":{"schedule":"every day 03:05","timeZone":"Europe/Bucharest","retryConfig":{}}}
[debug] [2025-07-29T20:43:46.085Z] shell:nightlyFinishBookings: opts={}, data={}
[debug] [2025-07-29T20:43:46.095Z] DEBUG: [worker-pool] addWorker(europe-west1-nightlyFinishBookings)
[debug] [2025-07-29T20:43:46.096Z] DEBUG: [worker-pool] Adding worker with key europe-west1-nightlyFinishBookings, total=1
[debug] [2025-07-29T20:43:46.747Z] DEBUG: [runtime-status] [71657] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-admin/lib/index.js"}
[debug] [2025-07-29T20:43:46.747Z] DEBUG: [runtime-status] [71657] Resolved module firebase-functions {"declared":true,"installed":true,"version":"6.4.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-functions/lib/v2/index.js"}
[debug] [2025-07-29T20:43:46.747Z] DEBUG: [runtime-status] [71657] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}]
[debug] [2025-07-29T20:43:46.748Z] DEBUG: [runtime-status] [71657] Resolved module firebase-functions {"declared":true,"installed":true,"version":"6.4.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-functions/lib/v2/index.js"}
[debug] [2025-07-29T20:43:46.948Z] DEBUG: [runtime-status] [71657] Checked functions.config() {"config":{}}
[debug] [2025-07-29T20:43:46.948Z] DEBUG: [runtime-status] [71657] firebase-functions has been stubbed. {"functionsResolution":{"declared":true,"installed":true,"version":"6.4.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-functions/lib/v2/index.js"}}
[debug] [2025-07-29T20:43:46.948Z] DEBUG: [runtime-status] [71657] Resolved module firebase-functions {"declared":true,"installed":true,"version":"6.4.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-functions/lib/v2/index.js"}
[debug] [2025-07-29T20:43:46.951Z] DEBUG: [runtime-status] [71657] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-admin/lib/index.js"}
[debug] [2025-07-29T20:43:46.952Z] DEBUG: [runtime-status] [71657] Resolved module firebase-functions {"declared":true,"installed":true,"version":"6.4.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-functions/lib/v2/index.js"}
[debug] [2025-07-29T20:43:46.953Z] DEBUG: [runtime-status] [71657] firebase-admin has been stubbed. {"adminResolution":{"declared":true,"installed":true,"version":"12.7.0","resolution":"/Users/evgeniy/Documents/crocus-crm/functions/node_modules/firebase-admin/lib/index.js"}}
[debug] [2025-07-29T20:43:46.959Z] DEBUG: [runtime-status] [71657] Functions runtime initialized. {"cwd":"/Users/evgeniy/Documents/crocus-crm/functions","node_version":"22.15.0"}
[debug] [2025-07-29T20:43:46.959Z] DEBUG: [runtime-status] [71657] Listening to port: /var/folders/4q/qlm_nrbs5z585pt74kvrrtwm0000gn/T/fire_emu_fa51640a9ae7d9a8.sock
[debug] [2025-07-29T20:43:47.017Z] DEBUG: [worker-europe-west1-nightlyFinishBookings-23e36ca7-5d54-4f9e-b7ef-82129bd628ae]: IDLE
[info] >  {"severity":"INFO","message":"[finish-cron] Target TZ=Europe/Bucharest, switching all checkOut ≤ 2025-07-28T00:00:00.000Z"} {"user":{"severity":"INFO","message":"[finish-cron] Target TZ=Europe/Bucharest, switching all checkOut ≤ 2025-07-28T00:00:00.000Z"},"metadata":{"emulator":{"name":"functions"},"function":{"name":"europe-west1-nightlyFinishBookings"},"extension":{},"message":"\u001b[90m> \u001b[39m {\"severity\":\"INFO\",\"message\":\"[finish-cron] Target TZ=Europe/Bucharest, switching all checkOut ≤ 2025-07-28T00:00:00.000Z\"}"}}
[warn] ⚠  Google API requested!
   - URL: "https://oauth2.googleapis.com/token"
   - Be careful, this may be a production service. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"europe-west1-nightlyFinishBookings"},"extension":{},"message":"Google API requested!\n   - URL: \"https://oauth2.googleapis.com/token\"\n   - Be careful, this may be a production service."}}
[info] >  {"severity":"INFO","message":"[finish-cron] scanned=28, updated=10"} {"user":{"severity":"INFO","message":"[finish-cron] scanned=28, updated=10"},"metadata":{"emulator":{"name":"functions"},"function":{"name":"europe-west1-nightlyFinishBookings"},"extension":{},"message":"\u001b[90m> \u001b[39m {\"severity\":\"INFO\",\"message\":\"[finish-cron] scanned=28, updated=10\"}"}}
[info] >  {"scanned":28,"updated":10,"severity":"INFO","message":"[finish-cron] Done"} {"user":{"scanned":28,"updated":10,"severity":"INFO","message":"[finish-cron] Done"},"metadata":{"emulator":{"name":"functions"},"function":{"name":"europe-west1-nightlyFinishBookings"},"extension":{},"message":"\u001b[90m> \u001b[39m {\"scanned\":28,\"updated\":10,\"severity\":\"INFO\",\"message\":\"[finish-cron] Done\"}"}}
